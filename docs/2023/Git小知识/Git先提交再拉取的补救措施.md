# Git先提交再拉取的补救措施

> 2024年2月28日16:09:54

## 一、背景

* 我们一般都说，先拉取再提交。
* 虽然**“先拉取再提交”**的实际意思是**“先pull再push"**。
* 但我们也可以探讨**“先pull再commit"**，以及出了问题以后的补救措施。

### (一)先提再拉有历史记录

* 如果**先commit再pull**的话，在git记录上会有如下提示：

```text
Merge remote-tracking branch 'origin/now-branch' into now-branch
```

* 这句提示的意思是，你正在将远程仓库origin的now-branch分支的最新内容合并到你当前所在的now-branch分支。
* 如上这句提示会一直留在git的历史记录中，很难看。

### (二)先拉再提会导致覆盖

> 如果我们遵从"先pull再commit"会怎么样呢？

* 而先拉取再提交会有一个问题：覆盖
* 虽然这个“覆盖”可以通过IDEA的本地历史记录来找回，但可以一开始就避免。

请看以下两个场景：

1. 张三的新开发的代码文件名叫"城门楼子.py"，而正巧，李四新开发的代码文件名也叫这个，但是李四比张三先提交并推送了(新增文件)。所以张三开发完成后(还没有commit)，拉取了一下git代码，结果他的代码被李四覆盖，全不见了。
2. 张三将"城门楼子.py"的第一行代码“胯骨轴子”改成“胯骨肘子”，而李四改的是“胯骨帚子”，并且李四先推送了。这个时候，张三在没有commit的情况下，拉取了李四的代码，他的“胯骨肘子”就变成了“胯骨帚子”，并且找不回来了。

## 二、变基

* 首先，我要说明的是，最好还是**先commit再pull**。
* 因为历史记录的问题，我们可以通过变基来解决；
* 但代码覆盖的问题，就比较麻烦了。

### (一)拉取后通过变基消除历史

**先commit再pull**会出现如下的历史记录：

```json
{name:"张三",  msg:"Merge remote-tracking branch 'origin/now-branch' into now-branch", branch:"now-branch", time:"7分钟前"},
{name:"张三",  msg:"张三提交未推送的代码", branch:"--", time:"7分钟前"},
{name:"李四",  msg:"张三提交后拉取的李四代码", branch:"origin/now-branch", time:"今天11:08"}
```

* 我们在IDEA中，将鼠标放在李四的提交上。(就是**远程分支的最新提交**)
* 然后右键，选择**【从这里进行交互式变基】**
* 在弹出的界面上，我们可以看到，**李四的提交**位于**我们未推送提交**的下方。
* 然后将我们**本地未推送的提交**，给**移动到李四提交的下面**(表示这是在李四提交之后我们再提交的)
* 然后选择右下角的**【启动变基】**，即可消除`Merge remote-tracking branch`这一历史记录。

### (二)在拉取时，就选择变基

IDEA在拉取时可以选择【在传入变更上变基当前分支】，用这个选项可以不用自己手动变基。